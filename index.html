<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Markdown Viewer
  </title>
  <style>
   :root {
      --bg: #1a1b23;
      --panel: #1f2130;
      --fg: #e6e6e6;
      --muted: #b6b8c4;
      --accent: #6ea8fe;
    }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    header {
      padding: 12px 16px;
      border-bottom: 1px solid #2a2a3a;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      background: rgba(26,26,38,.95);
      z-index: 10;
    }
    #title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
    }
    #markdown-source-label {
      font-size: 0.92rem;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 60vw;
    }
    main {
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
    }
    article {
      line-height: 1.6;
    }
    h1, h2, h3 { line-height: 1.2; margin-top: 1em; margin-bottom: .5em; }
    pre { background: #0b0b0b; padding: 12px; border-radius: 6px; overflow: auto; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas; }
    a { color: #8ab4f8; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
 </head>
 <body>
  <header>
   <div id="title">
    <span style="font-size: 1.1rem; font-weight: 700;">
     Markdown Viewer
    </span>
   </div>
   <div aria-live="polite" id="markdown-source-label">
    Source: local input.md
   </div>
  </header>
  <main>
   <section id="markdown-container">
    <article id="markdown-content">
    </article>
   </section>
  </main>
  <!-- External libraries -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js">
  </script>
  <script>
   (function () {
      const contentEl = document.getElementById('markdown-content');
      const sourceLabel = document.getElementById('markdown-source-label');

      // Render markdown to HTML + syntax highlighting
      function renderMarkdown(md) {
        const html = marked.parse(md, {
          gfm: true,
          breaks: true
        });
        contentEl.innerHTML = html;

        // Highlight code blocks if hljs is available
        if (typeof hljs !== 'undefined') {
          document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightElement(block);
          });
        }
      }

      function updateSourceLabel(text) {
        if (sourceLabel) sourceLabel.textContent = text;
      }

      function loadMarkdownFromText(md, sourceName) {
        renderMarkdown(md);
        updateSourceLabel('Source: ' + sourceName);
        document.title = 'Markdown Viewer â ' + sourceName;
      }

      function fetchMarkdownFrom(url, onSuccess, onError) {
        fetch(url)
          .then(res => {
            if (!res.ok) throw new Error('Request failed: ' + res.status);
            return res.text();
          })
          .then(text => onSuccess(text))
          .catch(err => onError(err));
      }

      // Check for ?url= parameter
      const urlParams = new URLSearchParams(window.location.search);
      const remoteUrl = urlParams.get('url');
      const localDefault = 'input.md';

      if (remoteUrl) {
        updateSourceLabel('Source: URL â ' + remoteUrl);
        fetchMarkdownFrom(remoteUrl,
          (md) => {
            loadMarkdownFromText(md, remoteUrl);
          },
          () => {
            // Fallback to local attachment if URL load fails
            updateSourceLabel('Source: URL failed, falling back to ' + localDefault);
            fetchMarkdownFrom(localDefault,
              (md) => loadMarkdownFromText(md, localDefault),
              () => {
                contentEl.innerHTML = '<p>Unable to load markdown from URL or local attachment.</p>';
                updateSourceLabel('Source: unavailable');
              });
          });
      } else {
        // No URL param; load local attachment by default
        fetchMarkdownFrom(localDefault,
          (md) => loadMarkdownFromText(md, localDefault),
          () => {
            contentEl.innerHTML = '<p>Unable to load local attachment.</p>';
            updateSourceLabel('Source: unavailable');
          });
      }
    })();
  </script>
 </body>
</html>
