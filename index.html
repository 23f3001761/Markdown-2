<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Markdown Live Preview with Word Count
  </title>
  <style>
   :root {
      --bg: #0b1020;
      --panel: #141a2a;
      --border: #2b3650;
      --text: #e6eaf7;
      --muted: #9aa4b2;
      --badge: #374151;
    }

    html, body {
      height: 100%;
      margin: 0;
      background: #0b1020;
      color: #e6eaf7;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 18px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 8px 0 16px;
    }

    h1 {
      font-size: 1.25rem;
      margin: 0;
      font-weight: 600;
    }

    .badge {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas;
      background: var(--badge);
      color: #fff;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.95rem;
      user-select: none;
      white-space: nowrap;
    }

    .layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      align-items: stretch;
    }

    .panel {
      background: #0e1430;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 10px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.04);
    }

    textarea#markdown-input {
      width: 100%;
      height: 70vh;
      min-height: 320px;
      resize: vertical;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
      background: #0b1220;
      color: #e8eaf8;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas;
      font-size: 14px;
      outline: none;
    }

    #preview {
      width: 100%;
      height: 70vh;
      min-height: 320px;
      overflow: auto;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: #0b1220;
    }

    /* Tiny typography improvements for rendered HTML */
    #preview h1, #preview h2, #preview h3 {
      color: #fff;
      margin: 0.5em 0 0.25em;
    }
    #preview p {
      line-height: 1.6;
      color: #e6eaf7;
    }
    #preview a { color: #93c5fd; text-decoration: none; }
    #preview a:hover { text-decoration: underline; }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
      textarea#markdown-input, #preview {
        height: 50vh;
        min-height: 260px;
      }
    }
  </style>
 </head>
 <body>
  <div class="container">
   <header>
    <h1>
     Markdown Live Preview
    </h1>
    <span aria-live="polite" class="badge" id="markdown-word-count" title="Word count badge">
     0
    </span>
   </header>
   <section aria-label="Markdown editor and preview" class="layout">
    <div aria-label="Markdown editor" class="panel">
     <textarea id="markdown-input" placeholder="Type Markdown here..." spellcheck="false"></textarea>
    </div>
    <div aria-label="Rendered preview" class="panel">
     <div aria-live="polite" class="preview" id="preview">
     </div>
    </div>
   </section>
  </div>
  <!-- Marked.js CDN (latest stable) -->
  <script src="https://cdn.jsdelivr.net/npm/marked@latest/marked.min.js">
  </script>
  <script>
   (function () {
      const wordCountBadge = document.getElementById('markdown-word-count');
      const inputEl = document.getElementById('markdown-input');
      const previewEl = document.getElementById('preview');

      // Simple word counter (splits on whitespace)
      function countWords(text) {
        if (!text) return 0;
        const t = text.trim();
        if (t.length === 0) return 0;
        // Treat any sequence of non-whitespace chars as a word
        return t.split(/\s+/).length;
      }

      // Update the badge with Intl.NumberFormat
      function updateWordCountFromText(text) {
        const cnt = countWords(text || '');
        const nf = new Intl.NumberFormat(undefined, { maximumFractionDigits: 0 });
        wordCountBadge.textContent = nf.format(cnt);
        wordCountBadge.title = `Word count: ${cnt}`;
      }

      // Render Markdown to HTML and update word count
      function renderMarkdown() {
        const md = inputEl.value;
        // Convert to HTML using Marked
        const html = marked(md);
        previewEl.innerHTML = html;
        // After render, update the word count
        updateWordCountFromText(md);
      }

      // Initialize by loading input.md if present
      function initFromFile() {
        fetch('input.md')
          .then(response => {
            if (!response.ok) throw new Error('input.md not found');
            return response.text();
          })
          .then(text => {
            inputEl.value = text;
            renderMarkdown();
          })
          .catch(() => {
            // If the file cannot be loaded, render with empty content
            inputEl.value = '';
            renderMarkdown();
          });
      }

      // Event: live update on input
      inputEl.addEventListener('input', () => {
        renderMarkdown();
      });

      // Start after DOM is ready
      document.addEventListener('DOMContentLoaded', initFromFile);
    })();
  </script>
 </body>
</html>
